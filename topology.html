<!DOCTYPE html>
<html>
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-60508041-1"></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-60508041-1');
    </script>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=775" />
    <title>Concourse CI - Deployment Topology</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="css/pipeline.css" />
    <link rel="stylesheet" type="text/css" href="css/iosevka.css" />
    <link rel="stylesheet" type="text/css" href="css/booklit.css" />
    <link rel="stylesheet" type="text/css" href="css/survey.css" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
    <script src="js/search.js"></script>
  </head>
  <body>
    <div id="top">
      <div class="header">
        <h1><a href="/" class="logo"></a><a href="/">Concourse</a></h1>

        <nav>
          <a href="tutorials.html">tutorial</a>
          <a href="reference.html">reference</a>
          <a href="https://discuss.concourse-ci.org">discuss</a>
          <a href="download.html">download</a>

          <div class="search" id="search"  onclick="gtag('event', 'search-click');">
            <input type="search" class="search-input" placeholder="Search the docs&hellip;" required="required" />
          </div>
        </nav>

        <script type="text/javascript">
          Elm.Main.embed(document.getElementById("search"));
        </script>
      </div>
    </div>
    <div id="content">
      <div class="side">
        




  
  
  
  
  
  
  

  
  <div class="context">
    <nav>
      <div class="top">
        
  <a href="index.html" >Docs</a>

      </div>

      <input type="checkbox" class="toggle"  />
      <span class="arrow"></span>
      <div class="children">
        <table>
        
          <tr>
            
              <td class="number-cell" align="right">1&nbsp;</td>
            
            <td class="title-cell">
  <a href="about.html" >About</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">2&nbsp;</td>
            
            <td class="title-cell">
  <a href="setup-and-operations.html" >Setup &amp; Operations</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">3&nbsp;</td>
            
            <td class="title-cell">
  <a href="concepts.html" >Concepts</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">4&nbsp;</td>
            
            <td class="title-cell">
  <a href="tutorials.html" >Tutorials</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">5&nbsp;</td>
            
            <td class="title-cell">
  <a href="reference.html" >Reference</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">6&nbsp;</td>
            
            <td class="title-cell">
  <a href="contribute.html" >Contribute</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">7&nbsp;</td>
            
            <td class="title-cell">
  <a href="community.html" >Community</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">8&nbsp;</td>
            
            <td class="title-cell">
  <a href="trademarks.html" >Trademarks</a>
</td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        
  <a href="setup-and-operations.html" >Setup &amp; Operations</a>

      </div>

      <input type="checkbox" class="toggle"  />
      <span class="arrow"></span>
      <div class="children">
        <table>
        
          <tr>
            
              <td class="number-cell" align="right">2.1&nbsp;</td>
            
            <td class="title-cell">
  <a href="download.html" >Download</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">2.2&nbsp;</td>
            
            <td class="title-cell">
  <a href="install.html" >Install</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">2.3&nbsp;</td>
            
            <td class="title-cell">
  <a href="getting-started.html" >Getting Started</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">2.4&nbsp;</td>
            
            <td class="title-cell">
  <a href="operation.html" >Operation</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">2.5&nbsp;</td>
            
            <td class="title-cell">
  <a href="teams.html" >Teams</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">2.6&nbsp;</td>
            
            <td class="title-cell">
  <a href="administration.html" >Administration</a>
</td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        
  <a href="operation.html" >Operation</a>

      </div>

      <input type="checkbox" class="toggle" checked />
      <span class="arrow"></span>
      <div class="children">
        <table>
        
          <tr>
            
              <td class="number-cell" align="left"></td>
            
            <td class="title-cell">
  <a href="topology.html"  class="self">Deployment Topology</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="left"></td>
            
            <td class="title-cell">
  <a href="encryption.html" >Encryption</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="left"></td>
            
            <td class="title-cell">
  <a href="creds.html" >Credential Management</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="left"></td>
            
            <td class="title-cell">
  <a href="metrics.html" >Metrics</a>
</td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        
  <a href="topology.html"  class="self">Deployment Topology</a>

      </div>

      <input type="checkbox" class="toggle" checked />
      <span class="arrow"></span>
      <div class="children">
        <table>
        
          <tr>
            
              <td class="number-cell" align="left"></td>
            
            <td class="title-cell">
  <a href="topology.html#web-node" ><code>web</code> node</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="left"></td>
            
            <td class="title-cell">
  <a href="topology.html#worker-node" ><code>worker</code> node</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="left"></td>
            
            <td class="title-cell">
  <a href="topology.html#db-node" >The <code>db</code> node</a>
</td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  






<ul class="improve-docs">
  <li><img src="images/github.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>

  <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
</ul>
      </div>
      <div class="page">
        <div class="section" id="section_topology">
  
  <h1 class="section-header"><a name="topology"></a>Deployment Topology</h1>
  

  <p>This document covers the characteristics and requirements of a Concourse deployment, in a way that is agnostic to <em>how</em> it&#39;s deployed. As such we&#39;ll use the term &#34;node&#34; to mean anything from a managed VM, to a container, to an individual process (in the event that they may all be running on the same machine).</p><p>A typical Concourse deployment has a <code>web</code> node, a <code>worker</code> node, and a PostgreSQL database running somewhere, which we&#39;ll call <code>db</code> for the sake of completeness.</p><p>Note that this document will use the default ports when describing which nodes talk to which other nodes. If you&#39;ve changed these defaults, keep that in mind.</p>

  
    
      <div class="section" id="section_web-node">
  
  <h2 class="section-header"><a name="web-node"></a>The <code>web</code> node</h2>
  

  <p>Components: <a href="concepts.html#component-atc">ATC</a> and <a href="concepts.html#component-tsa">TSA</a>.</p><p>Disk usage: none</p><p>CPU usage: peaks during pipeline scheduling, primarily when scheduling <a href="pipelines.html#pipeline-jobs"><code><strong>jobs</strong></code></a>. Mitigated by adding more <code>web</code> nodes. In this regard, <code>web</code> nodes can be considered compute-heavy more than anything else at large scale.</p><p>Bandwidth usage: aside from handling external traffic, the <code>web</code> node will at times have to stream bits out from one worker and into another while executing <a href="steps.html">Steps</a>.</p><p>Memory usage: not very well classified at the moment as it&#39;s not generally a concern. Give it a few gigabytes and keep an eye on it.</p><p>Highly available: yes; <code>web</code> nodes can all be configured the same (aside from <code>--peer-url</code>) and placed behind a load balancer. Periodic tasks like garbage-collection will not be duplicated for each node.</p><p>Horizontally scalable: yes; they will coordinate workloads using the database, resulting in less work for each node and thus lower CPU usage.</p><p>Outbound traffic:</p><ul>

  <li><p><code>db</code> on its configured port for persistence</p></li>

  <li><p><code>db</code> on its configured port for locking and coordinating in a multi-<code>web</code> node deployment</p></li>

  <li><p>directly-registered <code>worker</code> nodes on ports <code>7777</code>, <code>7788</code>, and <code>7799</code> for checking <a href="pipelines.html#pipeline-resources"><code><strong>resources</strong></code></a>, executing builds, and performing garbage-collection</p></li>

  <li><p>other <code>web</code> nodes (possibly itself) on an ephemeral port when a worker is forwarded through the web node&#39;s TSA</p></li>

</ul><p>Inbound traffic:</p><ul>

  <li><p><code>worker</code> connects to the TSA on port <code>2222</code> for registration</p></li>

  <li><p><code>worker</code> downloads inputs from the ATC during <a href="running-tasks.html#fly-execute"><code>fly execute</code></a> via its external URL</p></li>

  <li><p>external traffic to the ATC API via the web UI and <a href="fly.html"><code>fly</code></a></p></li>

</ul>

  
    
  
</div>
    
      <div class="section" id="section_worker-node">
  
  <h2 class="section-header"><a name="worker-node"></a>The <code>worker</code> node</h2>
  

  <p>Components: <a href="concepts.html#component-garden">Garden</a> and <a href="concepts.html#component-baggageclaim">BaggageClaim</a>.</p><p>Disk usage: arbitrary data will be written as builds run, and resource caches will be kept and garbage collected on their own life cycle. We suggest going for a larger disk size if it&#39;s not too much trouble. All state on disk must not outlive the worker itself; it is all ephemeral. If the worker is re-created (i.e. fresh VM/container and all processes were killed), it should be brought back with an empty disk.</p><p>CPU usage: almost entirely subject to pipeline workloads. More resources configured will result in more checking, and in-flight builds will use as much CPU as they want.</p><p>Bandwidth usage: again, almost entirely subject to pipeline workloads. Expect spikes from periodic checking, though the intervals should spread out over enough time. Resource fetching and pushing will also use arbitrary bandwidth.</p><p>Memory usage: also subject to pipeline workloads. Expect usage to increase with the number of containers on the worker and spike as builds run.</p><p>Highly available: not applicable. Workers are inherently singletons, as they&#39;re being used as drivers running entirely different workloads.</p><p>Horizontally scalable: yes; workers directly correlate to your capacity required by however many pipelines, resources, and in-flight builds you want to run. It makes sense to scale them up and down with demand.</p><p>Outbound traffic:</p><ul>

  <li><p>external traffic to arbitrary locations as a result of periodic resource checking and running builds</p></li>

  <li><p>external traffic to the <code>web</code> node&#39;s configured external URL when downloading the inputs for a <a href="running-tasks.html#fly-execute"><code>fly execute</code></a></p></li>

  <li><p>external traffic to the <code>web</code> node&#39;s TSA port (<code>2222</code>) for registering the worker</p></li>

</ul><p>Inbound traffic:</p><ul>

  <li><p>various connections from the <a href="topology.html#web-node"><code>web</code> node</a> on port <code>7777</code> (Garden), <code>7788</code> (BaggageClaim), and <code>7799</code> (garbage collection)</p></li>

  <li><p>repeated connections to <code>7788</code> and <code>7788</code> from the <a href="topology.html#web-node"><code>web</code> node</a>&#39;s TSA component as it heartbeats to ensure the worker is healthy</p></li>

</ul>

  
    
  
</div>
    
      <div class="section" id="section_db-node">
  
  <h2 class="section-header"><a name="db-node"></a>The <code>db</code> node</h2>
  

  <p>Components: PostgreSQL</p><p>Disk usage: pipeline configurations and various bookkeeping metadata for keeping track of jobs, builds, resources, containers, and volumes. In addition, <strong>all build logs are stored in the database</strong>. This is the primary source of disk usage. To mitigate this, users can configure <a href="jobs.html#job-build-logs-to-retain"><code><strong>build_logs_to_retain</strong></code></a> on a job, but currently there is no operator control for this setting. As a result, disk usage on the database can grow arbitrarily large.</p><p>CPU usage: this is one of the most volatile metrics, and one we try pretty hard to keep down. There will be near-constant database queries running, and while we try to keep them very simple, there is always more work to do. Expect to feed your database with at least a couple cores, ideally four to eight. Monitor this closely as the size of your deployment and the amount of traffic it&#39;s handling increases, and scale accordingly.</p><p>Bandwidth usage: well, it&#39;s a database, so it most definitely uses the network (duh). Not much should stand out here, though build logs can result in an arbitrary amount of data being sent over the network to the database. This should be nothing compared to worker bandwidth, though.</p><p>Memory usage: similar to CPU usage, but not quite as volatile.</p><p>Highly available: up to you. Clustered PostgreSQL is kind of new and probably tricky to deploy, but there are various cloud solutions for this.</p><p>Horizontally scalable: I...don&#39;t think so?</p><p>Outbound traffic:</p><ul>

  <li><p>none</p></li>

</ul><p>Inbound traffic:</p><ul>

  <li><p>only ever from the <code>web</code> node, specifically the <a href="concepts.html#component-atc">ATC</a></p></li>

</ul>

  
    
  
</div>
    
  
</div>
      </div>
      
    </div>
  </body>
</html>